# 订单物流轨迹数据初始化

本目录包含用于初始化订单物流轨迹数据的SQL脚本。

## 脚本说明

### 1. `init_all_order_logistics.sql`
主脚本，执行所有必要的初始化步骤：
- 为没有物流公司的订单分配物流公司
- 为所有订单生成完整的物流轨迹
- 验证结果并显示示例数据

### 2. `generate_complete_trajectories.sql`
核心脚本，为所有订单生成完整的物流轨迹：
- 创建生成中间点的辅助函数
- 为每个订单生成符合实际的物流轨迹
- 包含多个状态点：已下单、已取件、到达分拣中心、到达中转中心、到达本地配送点、派送中、已送达

### 3. `assign_logistics_providers.sql`
为没有物流公司的订单分配物流公司：
- 随机分配一个活跃的物流公司
- 验证分配结果

### 4. `generate_logistics_trajectories.sql`
为状态为"shipping"或"delivered"的订单生成物流轨迹：
- 为每个订单生成4个状态点：取件、运输中、派送中、已送达
- 使用随机位置生成轨迹点

## 使用方法

1. 执行主脚本（推荐）：
   ```sql
   \i init_all_order_logistics.sql
   ```

2. 或者分步执行：
   ```sql
   -- 先分配物流公司
   \i assign_logistics_providers.sql
   
   -- 然后生成轨迹
   \i generate_complete_trajectories.sql
   ```

## 轨迹数据说明

生成的轨迹数据包含以下特点：

1. **位置点**：使用真实的地理坐标（基于深圳市福田区）
2. **时间序列**：按照物流流程生成合理的时间间隔
3. **状态描述**：包含中文描述，符合实际物流流程
4. **地图显示**：所有轨迹点都使用PostGIS的Point类型，可以在地图上正确显示

## 轨迹状态说明

- `pickup`：已取件
- `in_transit`：运输中
- `out_for_delivery`：派送中
- `delivered`：已送达

## 注意事项

1. 脚本会删除现有的轨迹数据，然后重新生成
2. 生成的位置点是模拟的，但基于真实的地理坐标
3. 对于未送达的订单，不会生成"已送达"状态的轨迹点
4. 所有脚本都包含事务处理，确保数据一致性